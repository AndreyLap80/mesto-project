(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{nN:()=>M,lT:()=>H});var t="https://nomoreparties.co/v1/plus-cohort-14",n={Authorization:"5a9cae72-b390-4257-b620-5f35d3f837bc","Content-Type":"application/json"};function o(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}var r=document.querySelector(".profile__edit-button"),c=document.querySelector(".profile__avatar-edit-button"),a=document.querySelector(".popup__form"),i=document.querySelector(".form__input_popup_name"),u=document.querySelector(".form__input_popup_about"),l=document.querySelector(".profile__name"),s=document.querySelector(".profile__about-me"),d=document.querySelector(".profile__add-button"),_=document.querySelectorAll(".form__button_close"),m=document.querySelectorAll(".form__button_popup_save"),p=document.querySelector(".popup_opened_image"),f=document.querySelector(".popup_opened_card-delete"),v=document.querySelector(".popup_opened_card"),y=document.querySelector(".popup_opened_profile"),h=document.querySelector(".popup_opened_avatar"),S=document.querySelector(".popup__image"),b=document.querySelector(".popup__text");function k(e){e&&m.forEach((function(e){e.textContent="Сохранение..."}))}function q(e,t){e.classList.add("popup_opened"),document.querySelector(".form_card-delete").id=t,document.addEventListener("mousedown",E),document.addEventListener("keydown",L)}function E(e){e.target.closest(".popup__container,.popup__container-image")||g(e.target.closest(".popup"))}function L(e){if("Escape"===e.key){var t=document.querySelector(".popup.popup_opened");t&&g(t)}}function g(e){e.classList.remove("popup_opened"),document.removeEventListener("mousedown",E),document.removeEventListener("keydown",L)}var C=document.querySelector(".form_card"),x=document.querySelector(".avatar__form"),A=document.querySelector(".form_card-delete"),w=document.querySelector(".form__input_popup_link-avatar"),T=document.querySelector(".profile__avatar"),D=document.querySelector(".elements"),O=document.querySelector(".form__input_popup_designation"),P=document.querySelector(".form__input_popup_link-picture"),j=document.querySelector("#elements-template").content;function B(e){var t=e.name,n=e.link,o=e.likes,r=e.owner,c=e._id,a=j.cloneNode(!0),i=a.querySelector(".elements__mask-group"),u=a.querySelector(".elements__delete"),l=a.querySelector(".elements__like"),s=a.querySelector(".elements__like-counter");return a.querySelector(".elements__text").textContent=t,u.id=c,l.id=c,i.src=n,i.alt=t,s.textContent=o.length,i.addEventListener("click",(function(e){e.target.closest(".elements__rectangle"),function(e){var t=e.name,n=e.link;S.src=n,b.textContent=t,S.alt=t,q(p)}({name:t,link:n})})),u.addEventListener("click",(function(e){e.target.closest(".elements__rectangle"),q(f,e.target.id)})),l.addEventListener("click",(function(e){e.target.closest(".elements__like"),M(e.target.id,l,s),l.classList.toggle("elements__like_active")})),o.forEach((function(e){var t=e._id;H.id._id===t?l.classList.add("elements__like_active"):l.classList.remove("elements__like_active")})),r===H.id._id&&(u.style.display="block"),a}var N,J=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.removeAttribute("disabled"),t.classList.remove(n.inactiveButtonClass)):(t.setAttribute("disabled",!0),t.classList.add(n.inactiveButtonClass))},H={},z={};function M(e,r,c){var a,i;r.classList.contains("elements__like_active")?(i=e,fetch("".concat(t,"/cards/likes/").concat(i),{method:"DELETE",headers:n}).then(o)).then((function(e){c.textContent=e.likes.length})).catch((function(e){console.log(e)})):r.classList.contains("elements__like_active")||(a=e,fetch("".concat(t,"/cards/likes/").concat(a),{method:"PUT",headers:n}).then(o)).then((function(e){c.textContent=e.likes.length})).catch((function(e){console.log(e)}))}fetch("".concat(t,"/users/me"),{headers:n}).then(o).then((function(e){T.src=e.avatar,l.textContent=e.name,s.textContent=e.about,H.id=e})).catch((function(e){console.log(e)})),fetch("".concat(t,"/cards"),{headers:n}).then(o).then((function(e){return e.forEach((function(e){var t;t=B({name:e.name,link:e.link,likes:e.likes,owner:e.owner._id,_id:e._id}),D.prepend(t),z.info=e}))})).catch((function(e){console.log(e)})),C.addEventListener("submit",(function(e){var r,c=this;e.preventDefault(),k(!0),(r={name:O.value,link:P.value},fetch("".concat(t,"/cards"),{method:"POST",body:JSON.stringify({name:r.name,link:r.link}),headers:n}).then(o)).then((function(e){!function(e){D.prepend(B(e)),g(v)}({name:e.name,link:e.link,likes:e.likes,owner:e.owner._id,_id:e._id}),c.reset()})).catch((function(e){console.log(e)})).finally((function(){k(!1)}))}),J),x.addEventListener("submit",(function(e){var r,c=this;e.preventDefault(),k(!0),(r=w.value,fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:r}),headers:n}).then(o)).then((function(e){!function(e){T.src=e,g(h)}(e.avatar),c.reset()})).catch((function(e){console.log(e)})).finally((function(){k(!1)}))}),J),A.addEventListener("submit",(function(e){var r;e.preventDefault(),r=e.target.id,fetch("".concat(t,"/cards/").concat(r),{method:"DELETE",headers:n}).then(o),g(f)})),r.addEventListener("click",(function(){i.value=l.textContent,u.value=s.textContent,q(y)})),d.addEventListener("click",(function(){document.querySelectorAll(".form__button_popup_save").forEach((function(e){e.setAttribute("disabled",!0),e.classList.add("form__button_disabled")})),q(v)})),c.addEventListener("click",(function(){document.querySelectorAll(".form__button_popup_save").forEach((function(e){e.setAttribute("disabled",!0),e.classList.add("form__button_disabled")})),q(h)})),_.forEach((function(e){e.addEventListener("click",(function(e){g(e.target.closest(".popup"))}))})),a.addEventListener("submit",(function(e){var r;e.preventDefault(),k(!0),(r={name:i.value,about:u.value},fetch("".concat(t,"/users/me"),{method:"PATCH",body:JSON.stringify({name:r.name,about:r.about}),headers:n}).then(o)).then((function(e){var t;t={name:e.name,about:e.about},l.textContent=t.name,s.textContent=t.about,g(y)})).catch((function(e){console.log(e)})).finally((function(){k(!1)}))})),N={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button_popup_save",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},document.querySelectorAll(N.formSelector).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);J(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),J(n,o,t)}))}))}(e,N)}))})();